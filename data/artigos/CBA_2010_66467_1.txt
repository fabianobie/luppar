XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.

CALIBRACAO AUTOMATICA DE UMA REDE DE CAMERAS EM UM ESPACO
INTELIGENTE UTILIZANDO DADOS DE ODOMETRIA DE UM ROBO MOVEL
Mariana Rampinelli, Daniel Pizarro, Raquel Frizera Vassallo, Teodiano Freire
Bastos Filho


Laboratorio de Automacao Inteligente
Universidade Federal do Esprito Santo
Vitoria, Esprito Santo, Brasil


Departamento de Electronica
Universidad de Alcala
Alcala de Henares, Madri, Espanha
Emails mariana@ele.ufes.br, pizarro@depeca.uah.es, raquel@ele.ufes.br,
tfbastos@ele.ufes.br
Abstract This work describes the implementation of an automatic calibration system for a set of cameras
in an intelligent space. An intelligent space is defined as an environment with a network of sensors able to
obtain information from the observed world and a network of actuators that allows its interaction with users.
In such case, the system intelligence is at the environment. The applications of intelligent spaces are numerous
and cover many fields of service robotics, security tasks and helps people with special needs. In such space, the
artificial vision is potentially useful to provide many kinds of information. However, in order to use artificial
vision, the video cameras must be properly calibrated. For this reason, a calibration system for a set of cameras
was developed. The field of view of theses cameras can be overlapped or not. In order to make the process more
automatic and less costly, mobile robot of the intelligent space was used with a calibration pattern made with
infrared diodes. Approximate values of calibration parameters were found from a known algorithm. Then, the
robots odometry was used to optimize these calibration parameters.
Keywords

Intelligent Space, Computer Vision, Multi-camera System, Camera Calibration, Mobile Robot.

Resumo Este trabalho descreve a implementacao de um sistema de calibracao automatico de um conjunto
de cameras em um espaco_inteligente. Um espaco_inteligente e definido como um ambiente dotado de uma rede
de sensores capazes de obter informacoes do mundo que observa e uma rede de atuadores que permitem sua
interacao com o usuario. Nesses casos, a inteligencia do sistema esta no proprio ambiente. As aplicacoes dos
espacos inteligentes sao numerosas e englobam diversos campos da robotica de servicos, tarefas de seguranca e
ajuda a pessoas com necessidades especiais. No espaco_inteligente, o uso de visao artificial e potencialmente util
por proporcionar varios tipos de informacoes. No entanto, para serem utilizadas, as cameras de vdeo devem estar
devidamente calibradas. Nesse sentido, foi desenvolvido um sistema de calibracao para um conjunto de cameras
cujo campo de visao pode ou nao ser sobreposto. De modo a tornar o processo mais automatico e menos custoso,
foi utilizado um robo_movel do proprio espaco_inteligente com um padrao de calibracao constitudo de diodos de
infravermelho. Valores aproximados dos parametros de calibracao foram encontrados a partir de um algoritmo
ja conhecido. Posteriormente, os dados da odometria do robo foram utilizados para otimizar os parametros de
calibracao.
Palavras-chave
.

1

Espaco Inteligente, Visao Computacional, Sistema Multi-cameras, Calibracao de Camera,

Introducao

Uma representacao de um espaco_inteligente pode
ser vista na Figura 1. O espaco_inteligente e dotado de uma rede_de_sensores capazes de obter
informacoes do mundo que observa e uma rede de
atuadores (robos, telas de informacao, etc.) que
permitem sua interacao com o usuario. Tais sensores sao inspecionados por um sistema supervisorio capaz de analisar as informacoes obtidas pelos
sensores e tomar decisoes.

Em sua grande maioria, as pesquisas no campo de
robotica_movel estao concentradas no desenvolvimento de robos mais autonomos e capazes de realizar tarefas cada vez mais complexas. Para isso,
e necessario que os robos obtenham informacoes
acerca de seu ambiente de trabalho e de sua propria localizacao dentro desse ambiente. Com os
avancos no campo de rede de computadores e de
tecnologia multimdia, nos ultimos anos iniciaramse pesquisas sobre como transferir o sensoriamento
para o ambiente, permitindo o uso de robos mais
simples e, consequentemente, mais baratos, para
realizacao de tarefas complexas.
Nesse contexto, iniciaram-se estudos sobre os
chamados Espacos ou Ambientes Inteligentes (Lee
et al., 1999 Sogo et al., 1999 Sasaki and Hashimoto, 2006 Chen et al., 2007 Pizarro, 2009).

As aplicacoes dos espacos inteligentes sao numerosas e englobam diversos campos da robotica
de servicos, tarefas de seguranca e vigilancia automatica e ajuda a pessoas com necessidades especiais. Especificamente no grupo de pesquisa da
UFES, o espaco_inteligente montado sera aplicado
para localizacao e guiagem da cadeira_de_rodas
robotizada desenvolvida pelo grupo de Robotica
da mesma instituicao e mostrada na Figura 2.

252

XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.
Generated by Foxit PDF Creator  Foxit Software
httpwww.foxitsoftware.com For evaluation only.

e potencialmente util por proporcionar varios tipos de informacoes e o seu uso nao esta limitado
apenas ao posicionamento, mas tambem ao reconhecimento de objetos e gestos do usuario. Alem
disso, o campo de visao abrangido por uma camera e relativamente grande, quando comparado
ao campo de observacao de outros sensores. No
entanto, as cameras de vdeo utilizadas devem estar devidamente calibradas no ambiente para permitir indentificar e posicionar os ,
pessoas ou qualquer outro objeto presente no espaco. No processo de calibracao sao estimados
os parametros intrnsecos, relativos as caractersticas internas, e extrnsecos, relativo ao posicionamento no ambiente, das cameras. Esses parametros permitem a transformacao entre o sistema
de coordenadas da imagem para o sistema de coordenadas do mundo (Zhang, 1999 Hartley and
Zisserman, 2003 Sasaki and Hashimoto, 2006 Pizarro, 2009).

Figura 1 Representacao tridimencional do espaco
inteligente.
A partir da integracao com a Interface HomemMaquina desenvolvida pela UFES e baseada no reconhecimento de intencao de movimento (Ferreira
et al., 2009), pessoas com deficiencia motora severa, ou seja, pessoas que tenham perdido todos
os seus movimentos musculares voluntarios, poderao guiar a cadeira_de_rodas robotizada desde
uma localizacao inicial ate uma localizacao final
utilizando unicamente sinais cerebrais. Esse e o
caso, por exemplo, de pessoas com Esclerose Lateral Amiotrofica, tumores na Medula Espinhal,
alguns tipos de Distrofia Muscular e outros tipos
de deficiencia.

Nesse sentido, o objetivo deste trabalho e desenvolver um sistema de calibracao nao supervisionado para redes de cameras. Especificamente,
pretende-se abordar o problema existente em configuracoes de cameras na qual o grau de sobreposicao do campo de visao de todas elas e limitado.
De modo a tornar o processo mais automatico e menos custoso, como e usual em diferentes
sistemas (Hashimoto et al., 2003 Rekleitis and
Dudek, 2005 Chen et al., 2007 Kamath, 2007),
foi utilizado um robo_movel do proprio espaco_inteligente equipado com um padrao de calibracao
convencional, de facil identificacao pelas cameras.
Pelo movimento do robo no espaco ocupado pelas
cameras e pela deteccao do padrao embarcado no
robo, obtem-se a informacao visual que sera utilizada no algoritmo de calibracao (Zhang, 1999).
Tal informacao e, em geral, incompleta se existirem subgrupo de cameras que nao se conectam
por sobreposicao dos seus campos de visao, permitindo multiplas solucoes para seus parametros
extrnsecos com respeito a uma origem de coordenadas no mundo. Para resolver tal problema, este
trabalho propoe o uso de sensores do proprio robo,
cujas informacoes sao integradas diretamente ao
algoritmo de calibracao, fixando as restricoes geometricas necessarias para resolver as ambiguidades existentes.

Figura 2 Cadeira de rodas robotizada desenvolvida pela UFES.
A localizacao final para a qual a pessoa com
deficiencia deseja deslocar-se (por exemplo, banheiro, cozinha, quarto, etc.) pode ser escolhida
utilizando piscadas de olhos (sinais mioeletricos EMG), movimento do globo ocular (sinais videooculograficos - VOG) ou sinais cerebrais (sinais eletroencefalograficos - EEG) (Ferreira et al., 2008),
sendo possvel selecionar cones (smbolos) que representam os distintos ambientes e que podem ser
visualizados em um PDA (Personal Digital Assistant ou, em portugues, Assistente Digital Pessoal)
a bordo da cadeira_de_rodas. Uma vez escolhida
a localizacao final (smbolo) para onde a pessoa
com deficiencia deseja se dirigir, o sistema de guiagem desenvolvido neste projeto devera conduzir
a cadeira_de_rodas ate a localizacao desejada.
No espaco_inteligente, o uso de visao artificial

O restante deste artigo organiza-se da seguinte forma. Na proxima Secao esta descrito o
processo de deteccao das marcas que constituem
o padrao de calibracao. A Secao III descreve o
modelo de camera considerado e a matematica do
algoritmo de calibracao proposto. Os resultados
experimentais sao mostrados na Secao IV. Finalmente, na Secao V sao apresentadas as conclusoes
e propostas para trabalhos futuros.

253

XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.

Figura 3 Padrao para calibracao das cameras do
espaco_inteligente.
Figura 4 Resultado do processo de deteccao de
marcas.
2

Deteccao de Marcas
3

O padrao de calibracao utilizado no desenvolvimento deste trabalho, mostrado na Figura 3,
constitui-se de 33 diodos emissores de infravermelho (dos quais apenas 27 foram utilizados). Nesse
padrao, montado sobre o robo_movel, uma das
marcas e composta de 4 diodos infravermelho (ver
detalhe na Figura 3), que e usada como referencia,
e as demais, de 1 diodo. No sistema de visao do
espaco_inteligente, os diodos sao facilmente detectados, inclusive em condicoes de mudancas iluminacao, uma vez que as cameras nao possuem filtro
de infravermelho, simplificando a implementacao
dos algoritmos de processamento_de_imagens utilizados (Fernandez, 2005).

Calibracao

Na reconstrucao 3D ou no calculo da posicao de
objetos no espaco utilizando cameras, e necessario
que se estabelecam relacoes entre as coordenadas
de pontos 3D com as coordenadas 2D do plano
imagem.
Para uma camera i disposta no espaco_inteligente, existe um modelo de projecao geometrico
j
i
mj,i
k  h(M ,Xk ,P ) que relaciona um ponto trij
dimensional M  (xj , y j , z j )T do padrao, referenciado a partir da origem de coordenadas do
robo OR , quando o mesmo esta em Xk referenciado no mundo (OW ), com sua imagem mj,i
k 
(uk , vk )T capturada no k-esimo instante de tempo
pela camera i, sendo j o ndice de cada uma das
24 marcas do padrao. Essa relacao e definida a
partir dos parametros da camera. Tais parametros sao divididos em dois grupos intrnsecos e
extrnsecos. Os parametros intrnsecos sao necessarios para associar as coordenadas do pixel de
um ponto na imagem com o sistema coordenadas
da camera, OC i . Os parametros extrnsecos relacionam o sistema de coordenadas da camera ao
sistema de coordenadas do mundo, OW .
O modelo de camera utilizado neste trabalho
e conhecido como pinhole. Nesse modelo, nao se
consideram os parametros de distorcao, ou cisalhamento. Os parametros intrnsecos podem ser
agrupados na matriz Ki , para cada camera, descrita como

O processo de identificacao das marcas foi realizado em tres etapas Pre-processamento, Selecao
e Classificacao.
A etapa de pre-processamento consiste em suavizar e binarizar a imagem original. Na etapa
de selecao, sao encontrados os pixels do contorno
dos objetos da imagem. Esses pixels sao usado
para estimar a elipse que melhor se aproxima de
cada objeto. Com os parametros da elipse estimados, e possvel eliminar os objetos a partir de
suas caractersticas area, quantidade de pixel e
excentricidade da elipse estimada. E importante
ressaltar que, uma vez que a imagem dos diodos
aproxima-se de um crculo, o valor da excentricidade da elipse estimada deve ser proximo a 1.
Por ultimo, a classificacao identifica as marcas restantes, sendo a primeira marca definida como a
maior.

fui

0
K 
0


i

Uma descricao mais detalhada desse algoritmo e encontrado em (Fernandez, 2005). A Figura 4 mostra a imagem original capturada e o
resultado da deteccao das marcas.

0
fvi
0


ui0
v0i  ,
1

(1)

onde (u0 , v0 ) sao as coordenadas do ponto central da imagem e fui e fvi sao o fator de escala
no eixo u e v, respectivamente. Os parametros

254

XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.

extrnsecos sao o vetor de translacao, Ti , e os angulos de rotacao de Euler, (i ,  i ,  i ), que transformam um ponto no sistema de coordenadas OW
para o sistema de coordenadas da i-esima camera,
OC i (Hartley and Zisserman, 2003). O vetor de
parametros pode ser definido como
Pi  (i ,  i ,  i , (Ti )T , fui , fvi , ui0 , v0i )T .

pertencentes ao padrao de calibracao. Para um
ponto Mj do padrao, estando o robo na pose Xk ,
a camera i obtem a posicao no plano imagem de
tal ponto, definido como mj,i
k . Essa medida pode
ser prevista por
mj,i
k

(2)


h(Mj , Xk , Pi )
j,i i
 k K (Ri (Rk Mj + Tk ) + Ti ),

i
i
i
onde j,i
k e uma constante, K , R , T e a forma
matricial dos parametros de calibracao da camera
i e Rk e Tk sao obtidos a partir da pose do robo
Xk ,

Cada uma das M cameras utilizadas possui
um vetor Pi de parametros de calibracao distinto
das demais, obtido a partir do processo de calibracao descrito a seguir. O vetor coluna P 


T  T
T
P1 , ..., PM
engloba todos os vetores



cos(k )
Rk  sin(k )
0

de parametros para todas as M cameras, representando a calibracao completa do espaco_inteligente.
3.1

Estimativa inicial dos parametros de calibracao


0
0
1

 
xk
Tk   yk  .
0
(4)

N,i T
T
mi  (m1,i
1 ) ,    , (mK )

T

.

(5)

Do mesmo modo, define-se o vetor m como a
juncao de todas as medidas mi obtidas pelas M
cameras do espaco_inteligente
m  (m1 )T ,    , (mM )T

Robo movel com padrao de calibracao

T

.

(6)

Utilizando a funcao h, define-se facilmente a
seguinte relacao matematica h, na Equacao 7, entre os parametros de calibracao de todas as cameras P, o conjunto de poses do robo na trajetoria
X e o conjunto de medidas m

O padrao de calibracao consiste em um conjunto
de N pontos cujas coordenadas tridimensionais
Mj , j  1,    , N sao conhecidas em relacao a um
sistema de coordenas de referencia que coincide
com o eixo de rotacao do robo.
O robo possui sensores de odometria que permitem obter a posicao e a orientacao, ou seja
pose do mesmo, no plano do chao com respeito
a um vetor inicial que e determinado como a origem do sistema de coordenadas do mundo, OW .
Cada vetor de pose no instante k e descrito como
Xk  (xk , yk , k )T , onde xk , yk correspondem a
posicao do robo no plano-xy e k e a orientacao
do mesmo em relacao ao eixo z do mundo (perpendicular ao plano do chao).
Dada uma trajetoria do robo em um intervalo de tempo k  0,    , K e a pose do robo
em um instante inicial X0  (0, 0, 0)T , os sensores de odometria do robo determinam a sequencia
de poses X1 ,    , XK . O conjunto de poses do
robo no intervalo k  1,    , K e definido como
T T
X  (X1T ,    , XK
) .
3.3

sin(k )
cos(k )
0

O conjunto de todas as medidas obtidas pela
camera i na sequencia completa dos movimentos
do robo e para todos os pontos do padrao e definida por

A primeira etapa do processo de calibracao obtem os valores iniciais para os parametros Pi da
i-esima camera do espaco_inteligente. Para isso,
foi utilizado o algoritmo de calibracao apresentado
em (Zhang, 1999), mas estendido para todas as M
cameras do espaco_inteligente que se deseja calibrar. Esse metodo utiliza apenas um padrao de
calibracao coplanar.
3.2

(3)

m  h(X, P).
3.4

(7)

Otimizacao dos parametros de calibracao

O algoritmo de calibracao consiste em um criterio de maximo a posteriori (MAP) para refinar
as estimativas de pose (dadas pela odometria do
robo) e os parametros de calibracao que se deseja
calcular. Para facilitar os calculos futuros, esses
dados foram reunidos em um unico vetor  definido como   (PT , XT ). O criterio de MAP
resume-se em encontrar o maximo de
M AP  max p(m)p(),


(8)

onde p(m) e a funcao de densidade de probabilidade das medidas m dados os parametros  e a
funcao p() e a funcao de densidade de probabilidade a priori dos parametros .
Para o calculo da funcao de densidade de probabilidade a priori dos parametros , supoe-se
que a distribuicao de probabilidade gaussiana que

Medidas no plano imagem dos pontos do padrao em cada uma das cameras

A partir de cada camera do espaco_inteligente, sao
obtidos as medidas no plano imagem dos pontos

255

XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.

representa as medidas de odometria p(X) e conhecida. Essa distribuicao modela-se a partir de uma
distribuicao gaussiana com matriz de covariancia
X e um vetor media igual as medidas obtidas do
robo X  X, como detalhado em (Pizarro, 2009).
A funcao de densidade de probabilidade a priori p(P) dos parametros de calibracao P e modelada como uma distribuicao gaussiana com media P igual aos valores obtidos com o algoritmo
de (Zhang, 1999) e matriz de covariancia P obtida a partir dos erros de calibracao. Considerando que X e P sao estatisticamente independentes, pode-se obter a distribuicao a priori como
p()  p(X)p(P).
A funcao p(m) obtem-se como uma distribuicao gaussiana tendo como media a funcao
m  h() e com matriz covariancia m diagonal
por blocos onde se estabelece a incerteza existente
ao medir os pontos do padrao com o algoritmo
descrito na Secao 4 (Pizarro, 2009).
O criterio MAP de (8) e equivalente a funcao de custo, mostrada na Equacao 9, obtida ao
aplicar logaritmos e eliminar constantes que nao
modificam o valor do mnimo
M AP



4

O espaco_inteligente, cuja infraestrutura foi utilizada para o desenvolvimento deste trabalho, conta
com cinco cameras modelo DFK 21BF04 com sensor 14 CCD (The Imaging Source, 2008). Essas cameras estao sincronizadas e conectadas a um
conjunto de servidores (um por camera).
Os testes experimentais do sistema de deteccao e identificacao de marcas do padrao de calibracao realizados nesse ambiente obtiveram resultados satisfatorios, mesmo com mudancas de
iluminacao.
5


min (m  h())T 1
m (m  h()) +


(X  X)T 1
X (X  X) +

T 1
(P  P) P (P  P) .

(9)

Considerando-se que a distribuicao a priori
p(P) e desconhecida e supondo P  muito
grande, o ultimo termo pode ser eliminado, obtendo como resultado a funcao de custo simplificada
M AP



Resultados


min (m  h())T 1
m (m  h()) +


(X  X)T 1
(10)
X (X  X) .

As funcoes de custo (9) e (10) podem ser
minimizadas a partir de um metodo de otimizacao iterativo. Este trabalho utiliza o metodo
de Levenberg-Marquardt (Lourakis, 2005 Hartley
and Zisserman, 2003). E importante ressaltar
que, geralmente, o problema definido por tais funcoes de custo tem uma estrutura muito caracterstica que pode ser aproveitado para reduzir
a complexidade de cada iteracao, chamada LM
Sparse (Hartley and Zisserman, 2003).
O metodo MAP definido pela Equacao 10 permite modelar a incerteza dada pela estimativa de
odometria. A distribuicao p(X) serve como meio
de penalizar os dados de odometria com maior
incerteza ao mesmo tempo que forca que a solucao seja mais influenciada pelos valores com menor
incerteza. O resultado esperado e que os parametros de calibracao das cameras sejam melhorados
apenas pelos valores de odometria cuja estimacao
e mais precisa.

Conclusoes e Trabalhos Futuros

Neste trabalho foi desenvolvido um sistema de calibracao automatico de uma rede de cameras de
um espaco_inteligente. De modo a minimizar a
intervencao humana no sistema, foi utilizado um
padrao de calibracao coplanar composto de diodos
de infravermelho localizado na parte superior de
um robo_movel.
Uma vez que o campo de visao das cameras
pode ou nao ser sobreposto, e possvel que existam
multiplas solucoes para seus parametros extrnsecos. Desse modo, este trabalho propoe o uso de
dados da odometria do robo para fixar as restricoes geometricas necessarias e, consequentemente,
melhorar os parametros de calibracao da rede de
cameras.
O sistema para deteccao de marcas de calibracao funciona satisfatoriamente. Nesse momento, o
sistema de calibracao esta em fase de finalizacao
para realizacao de testes experimentais.
Agradecimentos
Os autores agradecem ao CNPq (Projeto de
Pesquisa Localizacao e Guiagem de Robos
Moveis Utilizando Visao Artificial e Tecnicas de Controle em Ambientes Inteligentes,
Processo 4824562007-8) e a CAPES (Projeto Espacos Inteligentes na Tecnologia de Assistencia - EINTA, Convenio CAPES-MECDDGUEspanha, no 15007) pelo financiamento
deste trabalho. Mariana Rampinelli agradece a
CAPES pela bolsa de Doutorado Sanduche que
permitiu sua estadia na Espanha.
Referencias
Chen, H., Matsumoto, K., Ota, J. and Arai, T.
(2007). Self-calibration of environmental camera for mobile robot navigation, Robotics
and Autonomous Systems 55(3) 177190.
Fernandez, I. (2005). Sistema de Posicionamiento
Absoluto de un Robot Movil utilizando Camaras Externas, PhD thesis, Universidad de

256

XVIII Congresso Brasileiro de Automática  12 a 16 Setembro 2010, Bonito-MS.

Alcala, Escuela Politecnica Superior, Departamento de Electronica, Alcala de Henares.

Zhang, Z. (1999). Flexible camera calibration by
viewing a plane from unknown orientations,
International Conference on Computer Vision 1 666673.

Ferreira, A., Bastos Filho, T., Sarcinelli Filho, M.,
, Martn, J. L., Garca, J. C. and Mazo, M.
(2009). Improvements of a brain-computer
interface applied to a robotic wheelchair,
Communications in Computer and Information Science CCIS52 64  73.
Ferreira, A., Cardoso, W., Cheein, F. A., Bastos Filho, T., Sarcinelli Filho, M. and Carelli,
R. (2008). Human-machine interfaces based
on emg and eeg applied to robotic systems,
Journal of NeuroEngineering and Rehabilitation 5 1 15.
Hartley, R. and Zisserman, A. (2003). Multiple View Geometry in computer_vision, Cambridge University Press, Cambridge.
Hashimoto, H., Lee, J.-H. and Ando, N. (2003).
Self-identification of distributed intelligent
networked device in intelligent space, Vol. 3,
pp. 4172  4177 vol.3.
Kamath, S. (2007). Distributed algorithms for camera network localization and multiple target
tracking using mobile robots, Master of science, Faculty of Rensselaer Polytechnic Institute, Troy, Nova Iorque (EUA).
Lee, J.-H., Ando, N. and Hashimoto, H. (1999).
Intelligent space for human and mobile robot,
pp. 784 784.
Lourakis, M. I. A. (2005). A Brief Description
of the Levenberg-Marquardt Algorithm Implemened by levmar.
Pizarro, D. (2009). Localizacion de robots moviles en espacios inteligentes utilizando camaras externas y marcas naturales, Phd., Universidad de Alcala, Alcala de Henares (Madrid).
Rekleitis, I. and Dudek, G. (2005). Automated calibration of a camera sensor network,
pp. 3384  3389.
Sasaki, T. and Hashimoto, H. (2006).
Camera calibration using mobile robot in intelligent space, SICE-ICASE, 2006. International Joint Conference, IEEE Computer Society, Los Alamitos, CA, USA, pp. 26572662.
Sogo, T., Ishiguro, H. and Ishida, T. (1999). Acquisition of qualitative spatial representation
by visual observation, Proc. 16th Intl. Joint
Conf. on AI (IJCAI-99, Morgan Kaufmann,
pp. 10541060.
The Imaging Source (2008). DFK 21BF04 - Overview.

257
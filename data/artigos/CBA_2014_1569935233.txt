Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

EXTRACAO AUTOMATICA DE TEMPO MUSICAL UTILIZANDO
TRANSFORMADA WAVELET E O ESPECTRO RITMICO
Antonio Carlos Lopes Fernandes Jr., Furio Damiani


Universidade Estadual de Campinas
Faculdade de Engenharia Eletrica e de Computacao
Departamento de Semicondutores Instrumentos e Fotonica
Campinas, Sao Paulo, Brasil
Emails aclfjr@dsif.fee.unicamp.br, furio@dsif.fee.unicamp.br
Abstract The detection of tempo in a musical signal is a very important task, and still open, for many
applications in music information retrieval area. In this paper, we present the result of tempo detection process
using a new approach based on Wavelet Transform, Complex Domain and the Rhythmic Spectrum. The Wavelet
Transform is used to separate the musical signal in different resolutions to build multiresolution Onset Detection
Functions using the method of the Complex Domain. Then multiresolution Periodicity Detection Functions are
generated by autocorrelation functions. Then a new descriptor proposed by us, the Rhythmic Spectrum, is used
to calculate two tempo candidates frequencies. The final decision is taken from a heuristic method based on some
musical metrical structures.
Keywords Music Information Retrieval (MIR), Tempo Detection, Onsets, Audio Descriptors, Feature Extraction,Digital Signal Processing.
Resumo A deteccao_de_tempo em um sinal musical e uma tarefa muito importante, e ainda aberta, para
diversas aplicacoes na area de recuperacao de informacao musical. Neste artigo apresentamos o resultado da
deteccao de andamento utilizando uma nova proposta baseada em Transformada Wavelet, Domnio Complexo e
o Espectro Rtmico. A Transformada Wavelet e utilizada para separar o sinal musical em resolucoes distintas
para construcao de Funcoes de Deteccao de Onsets multirresolucionais usando o metodo do Domnio Complexo.
Em seguida, Funcoes de Deteccao de Periodicidades multirresolucionais sao geradas por intermedio de funcoes de
autocorrelacao. Em seguida, um novo descritor proposto por nos, o Espectro Rtmico, e utilizado para o calculo
de duas frequencias candidatas ao tempo musical. A decisao final e tomada a partir de um metodo heurstico
baseado em algumas estruturas metricas musicais.
Palavras-chave .

1

Introducao

completo nao e das mais simples.
Neste artigo, propomos o uso conjunto da
Transformada Wavelet com o Domnio Complexo
(complex domain) para a construcao de Funcoes
de Deteccao de Onsets em nveis de resolucao distintos, o calculo posterior das Funcoes de Deteccao
de Periodicidades nestes diversos nveis, a utilizacao da Transformada de Fourier destas funcoes de
periodicidades para o calculo de frequencias rtmicas candidatas, a comparacao destas com um
novo metodo heurstico e a decisao do tempo musical correspondente.

Atualmente, com o avanco tecnologico na area do
audio digital e sua popularizacao a extracao_de_caractersticas destes sinais para uma determinada
aplicacao tornou-se um dos topicos mais importantes nesta area. Dentre as aplicacoes pode-se
destacar a classificacao de generos musicais, a geracao automatica de playlist e o Beat Tracking
(Lerch, 2012). Dentre as caractersticas mais fundamentais que necessitam ser conhecidas em um
sinal musical esta o tempo, dado em batidas por
minuto (bpm). O tempo de uma musica, ou andamento, e a taxa com que uma pessoa intuitivamente bate os pes para acompanha-la.

1.1

Bases Teoricas

Boa parte dos metodos atuais de deteccao de
tempo compartilham uma filosofia basica o calculo de uma Funcao de Detecao de Onsets (ODF )
e de uma Funcao de Detecao de Periodicidades
(PeDF ). A ODF e uma versao subamostrada do
sinal de audio que exibe os onsets do sinal musical desenvolvida a partir da observacao de mudancas em diferentes propriedades do sinal. A
PeDF e uma funcao que representa as periodicidades mais proeminentes exibidas na ODF de
onde se extrai, apos processamento, o tempo musical perceptual. Processos de pre-processamento
podem ou nao ser realizados antes do calculo da

Muita pesquisa tem sido feita com o objetivo
de calcular de forma automatizada o tempo de um
sinal musical. Em geral duas estrategias basicas
sao utilizadas a construcao de uma funcao que represente os eventos sonoros (onsets) que ocorrem
no sinal e a confeccao de uma funcao que represente as periodicidades existentes neste sinal de
onsets. Contudo dada a riqueza de detalhes que
existem em uma gravacao musical, inumeros instrumentos com espectros muitas vezes superpostos
e formas de onda temporais tambem superpostas,
a tarefa de se obter o andamento para o conjunto

173

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

ODF como por exemplo a separacao em bandas
de frequencias (Gainza and Coyle, 2011).

2

A Transformada Wavelet (Strang and Nguyen,
1997) se baseia no produto interno de um sinal
x(t) com uma base de funcoes oscilantes wjk (t) localizadas em um determinado intervalo de tempo
que sao escalonadas e deslocadas ao longo do eixo
temporal

Existem
varios
metodos
de
preprocessamento, geracao de ODF e PeDF e
pos-processamento utilizados em sistemas detectores de tempo. A ODF pode ser baseada em
caractersticas extradas do sinal ou em modelos
probabilsticos (Bello et al., 2005). No caso da
utilizacao de caractersticas dos sinais, o foco
pode estar no domnio do tempo ou no domnio
da frequencia. Em Laroche (2001) a ODF e
gerada a partir de mudancas de energia no sinal,
em Duxbury et al. (2003) tanto o modulo quanto
a fase sao utilizados para perceber mudancas no
sinal. Abordagens usando modelos probabilsticos
(Bello et al., 2005) sao baseadas no conceito de
que o sinal pode ser descrito por algum modelo
de probabilidade. O metodo de construcao da
PeDF mais utilizado e a funcao de autocorrelacao
(ACF ) (Alonso et al., 2004) (Dixon, 2006). Outros metodos incluem, por exemplo, comb filters
(Klapuri et al., 2006) (Scheirer, 1998), e analise
espectral (Peeters, 2011) (Alonso et al., 2004).
No que se refere ao pre-processamento as opcoes existentes seguem em linhas gerais dois
caminhos sinal unico como entrada (Davies
and Plumbley, 2007) ou analise em sub-bandas
(Gainza and Coyle, 2011).
Em relacao ao
pos-processamento da PeDF pode-se destacar
ponderacoes (Gainza and Coyle, 2011), imposicao
de limiares e construcao de histogramas.

Sistema Proposto

bjk < x(t), wjk (t) >

0.5
0
0.5
0.5

b) A7

B C

1

1.5

2

2.5

3

3.5

4

4.5

5
5
x 10

3500

4000

B BC

10
5
0
5
500

1000

1500

2000

2500

3000

c) D1

A proposta deste artigo segue a filosofia de que um
sistema de deteccao_de_tempo pode ser livremente
inspirado no sistema aural e neural humano. Com
isto, e necessario dotar o algoritmo de um sistema
analogo ao auditivo, capaz de separar estmulos
sonoros em faixas de frequencia, e de um sistema
analogo ao neural, capaz de tomar decisoes a respeito do tempo da peca musical. Optamos por
analise em sub-bandas do sinal musical de interesse. O objetivo aqui foi o de simular o comportamento de um musico quando este se concentra em
um determinado instrumento, dentre um conjunto
de fontes sonoras, para perceber o andamento no
qual ele deve executar o seu proprio instrumento.
Desta forma, decidimos gerar sinais em resolucoes
distintas, e a partir destas, construir as ODF equivalentes e posteriormente as PeDF equivalentes a
cada resolucao. Com isto escolhemos a Transformada Wavelet como a principal estrategia de preprocessamento para a analise mutirresolucao. A
instancia decisoria ficou a cargo da nova abordagem aqui proposta o Espectro Rtmico e a Decisao Heurstica.

(1)

onde j representa a escala, k representa o deslocamento e wjk  w(2j t  k) sao as versoes escalonadas e deslocadas de uma wavelet mae w(t).
Esta e a equacao de analise que gera os coeficientes bjk . A principal diferenca entre a base de
funcoes da Transformada Wavelet e da Transformada de Fourier esta no fato de que as wavelets
sao, na maioria das aplicacoes, de suporte compacto, isto e, restritas a um intervalo de tempo
bem definido enquanto a base de Fourier oscila
eternamente. Isto ja demonstra a capacidade das
wavelets de poderem localizar eventos no tempo.
Uma outra diferenca vem do processo de representacao de um sinal em diversas escalas. Atraves do
escalonamento das wavelets o mesmo sinal pode
ser visto com mais ou menos detalhes.
Para avaliar o poder desta ferramenta matematica para o contexto de extracao_de_caractersticas de audio musical realizamos uma Transformada Wavelet Discreta (DWT ) em um sinal de
bateria formado por bumbo (B) e caixa (C) sendo
executado a 100 bpm na Figura 1.
a) Sinal

1.2

Wavelets e Multirresolucao

0.05
0
0.05
0.5

1

1.5

Amostras

2

2.5
5
x 10

Figura 1 Decomposicao Wavelet em 7 nveis, coiflet (a) Sinal, (b) Aproximacao (A7 ), (c) Detalhe
1 (D1 ). Os outros detalhes foram omitidos para
simplificacao.
No topo da Figura 1 (letra a) esta o audio da
bateria com 44, 1 kHz de amostragem. O compasso equivale ao padrao (B, C, B, B, C) identificado na Figura 1 e que se repete por mais 4
vezes. Pode-se observar que no sinal aproximacao (A7 ) (letra b) a proeminencia e do bumbo.
O ultimo nvel de resolucao, detalhe 1 (D1 ) (letra c), mostra a presenca marcante da caixa e um
spike, provavelmente gerado pelo kick do pedal de
bumbo. Podemos observar entao que a multirresolucao promovida pela Transformada wavelet

174

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

separou o sinal em diferentes escalas.
Com este exemplo, percebe-se que um preprocessamento utilizando Wavelets pode gerar resultados interessantes para a deteccao de onsets
e uma posterior analise de periodicidades existentes no sinal. Desta forma, apos a avaliacao de
formas de wavelet mae e nveis possveis, decidimos utilizar a Transformada Wavelet com 5 nveis
de decomposicao e wavelet mae coiflet3. A escolha desta base de funcoes se deve ao fato das coiflets serem wavelets biortogonais e, portanto, de
fase linear, o que contribui para a simplificacao do
processo de compensacao de atrasos distintos no
banco de filtros (algoritmo DWT ) para os diferentes sinais em possveis aplicacoes do nosso sistema
em tempo_real.
Definiu-se o numero de amostras a serem processadas dos sinais como sendo potencia de base
2, para adequacoes ao algoritmo DWT. Entao,
os sinais analisados possuem 524.288 amostras
(219 ), o que corresponde a aproximadamente 11,89
segundos de audio (em taxa de amostragem de
44,1kHz). Assim, foram gerados, para cada arquivo de audio, 6 vetores de coeficientes Wavelet
Aproximacao 5 (A5 ), Detalhe 5 (D5 ), Detalhe 4
(D4 ), Detalhe 3 (D3 ), Detalhe 2 (D2 ), e Detalhe
1 (D1 ). Cada vetor passou pelos processamentos
indicados nas secoes a seguir.
3

utiliza tanto as informacoes de magnitude quanto
de fase dos espectros dos frames. Comparacoes
entre quadros adjacentes sao utilizadas para avaliar se houve ou nao um onset entre dois blocos.
A Transformada de Fourier do n-esimo frame, janelada por uma janela de Hanning H(m) de tamanho N de um sinal x(n) e dada por,

X(k, n) 

N
1
X

x(m)H(m)e

2jmk
N

,

(2)

m0

onde X(k, n) e o k-esimo bin do n-esimo frame
transformado. Cada bin de cada frame e possui
um valor de amplitude e de fase. Estas duas informacoes para uma determinada frequencia, de
um frame, podem ser visualizadas como um fasor.
Para um frame subsequente podem haver mudancas de amplitude e fase do fasor. A distancia Euclidiana entre os dois fasores e o parametro utilizado para a construcao da ODFCD (Equacao 3)
q
k (n)  Rk2 (n) + Rk2 (n)  2Rk (n)Rk (n)C (3)
onde (n) e a distancia Euclidiana, Rk (n) e Rk (n)
sao os modulos da STFT de frames adjacentes,
C  cos( ),   princargk (n)  k (n),
k (n) e k (n)  2k (n  1)  k (n  2), as fases dos espectros de frames adjacentes. A funcao
princarg mapeia a fase para o intervalo , .
Desta forma a ODFCD e calculada por intermedio da soma de todos os bins em um frame
(Equacao 4)

Funcoes de Deteccao de Onsets

A geracao de ODF, processo tambem denominado de reducao, esta associada a tarefa de deteccao de onsets de forma bastante consolidada
(Bello et al., 2005) (Bello et al., 2004) (Gainza and
Coyle, 2011) (Dixon, 2006). O objetivo da reducao e, independente de pre-processamentos, transformar um sinal de audio em uma versao drasticamente subamostrada que possua as ocorrencias
de transientes do sinal original.
De um modo geral os metodos de reducao podem ser divididos em dois grandes grupos metodos baseados no uso de caractersticas predefinidas
do sinal ou metodos baseados em modelos probabilsticos do sinal (Dixon, 2006). Dentre os metodos existentes optou-se por realizar um metodo espectral Domnio Complexo (ODFCD ) (Duxbury
et al., 2003). Este metodo e mais adequado do
que o puramente energetico para sinais polifonicos
e para detectar onsets suaves gerados por instrumentos sem ataque percussivo, como por exemplo
instrumentos de sopro e algumas cordas, como o
violino excitado com arco.
A abordagem geral e a separacao do sinal alvo
em frames, com determinado numero de amostras,
e cada frame, apos o processo de reducao, gera um
valor que compoe a ODF, representando um onset
musical. O padrao aqui utilizado foi um tamanho
de frame igual a 2048 amostras.
O metodo do Domnio Complexo (ODFCD )

ODFCD (n) 

N
X

k (n).

(4)

k0

Uma ODF e exibida na Figura 2 letra b. O
sinal analisado x(t) e o mesmo audio de bateria
anterior. A ODF e processada com um filtro de
media movel (MA), Figura 2 letra b, e este processo gera um limiar abaixo do qual a funcao e
descartada gerando um versao que chamamos de
ODF limitada (ODFL ) (Figura 2, letra c).
Observe que, na Figura 2 letra b, os onsets
(asteriscos) foram localizados, para ilustracao,
apos um processo de peak picking, por uma busca
de maximos locais. A ODF limitada (ODFL ) foi
calculada para cada resolucao de todas as musicas
do banco_de_dados e utilizada para o calculo das
PeDF na proxima secao.
4

Funcoes de Deteccao de Periodicidades

A chamada Funcao de Deteccao de Periodicidade
(PeDF ) (Gainza and Coyle, 2011) expressa as periodicidades existentes no sinal musical. A partir das periodicidades das ODF de cada resolucao gera-se um conjunto de P eDF correspondentes por intermedio de funcoes de autocorrelacao

175

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014
4

1.5

2

2.5

3

3.5

Amostras

ODFCD

50

100

Frames

4

4.5

5
5
x 10

Média Móvel Onset

150

200

1

1

6000
4000
2000

x 10

2

1

250
0

5000
1
300

0

50

100

Frames

150

200

5

1.5

1

0.5

0
300

200

100

0

100

200

300

D (Amostras)

Figura 3 PeDF da aproximacao 5 (P eDFA5 ).
(ACF ). Esta funcao examina quao similar uma
sequencia x(n) e quando comparada com seus valores previos quando se desloca a sequencia de diversos valores de atraso D. Desta forma, a PeDF
calculada em nossa abordagem se torna
N 1
1 X
P eDF (D) 
ODFL (D)ODFL (n + D)
N n0
(5)
Para avaliar as PeDF multirresolucionais de
um sinal musical, mostraremos resultados obtidos a partir de uma musica do banco_de_dados
construdo para este trabalho. A cancao e de um
grupo brasileiro executada a 82 bpm com guitarra,
baixo, bateria, teclado e outros instrumentos de
percussao, onde ha uma fusao de alguns generos
musicais como baiao, reggae e rock 
Observa-se da Figura 3 que a sua P eDFA5
exibe dois valores candidatos D  8 e D  16.
Utilizando a equacao de reducao (Fernandes Jr
and Damiani, 2013), que leva em conta o tamanho
dos frames (2048 amostras) e a taxa de amostragem do sinal de audio original,

T 

60
(2048)(144100)(D )

100

200

300

contrario ocorre com o grafico da P eDFD1 na Figura 4, onde a dinamica de amplitudes da funcao
torna a tarefa do calculo do melhor candidato a
tempo um processo arduo.
As diferencas existentes entre os dois casos,
aqui exibidos, e as existentes tambem nas outras
4 resolucoes, omitidas por questoes de espaco no
texto, sugerem que uma das resolucoes pode ser
eleita para o calculo do andamento musical ou que
todas podem ser avaliadas para o reconhecimento
de um padrao de tempo comum. Logo, assim como
um musico real faria para descobrir com que andamento tocaria seu instrumento para acompanhar
um conjunto musical ouvindo ou a massa sonora
completa ou um instrumento especfico, e preciso
uma estrategia de decisao que escolha a melhor resolucao, ou o melhor conjunto de resolucoes, para
um determinado sinal de entrada.
O metodo da ACF por si so, nao e suficiente
para o calculo automatico de periodicidades. Isto
se deve a grande dinamica que pode ocorrer nestas
funcoes, ao aparecimento de multiplos e submultiplos do perodo e ao fato de eventos de amplitude
baixa em alta frequencia poderem parecer menos
importantes. Contudo, o uso da Transformada
Wavelet para analise mutirresolucao permite a observacao de P eDF multirresolucionais que podem
suplantar as dificuldades elencadas anteriormente.
Mas para isto se faz necessario a escolha do melhor
nvel de resolucao e do melhor candidato a tempo
dentro do nvel escolhido. Para os nossos objetivos de calculo automatico de andamento musical e preciso projetar uma instancia decisoria que
sera alimentada pelas P eDF multirresolucionais
para uma tomada_de_decisao. Esta instancia utiliza uma nova abordagem denominada Espectro
Rtmico.

D16

D8

0

Figura 4 PeDF do detalhe 1 (P eDFD1 ).

x 10

2

100

D (Amostras)

4

2.5

200

250

Figura 2 ODF calculada a partir de sinal de bateria da Figura 1 (a) audio bateria (x(t)), (b)
ODFCD , Media Movel e onsets, (c) ODFL .

PeDFA

b) ODFCD

4

C

3

0.5

c) ODFL

B

PeDFD

a) x(t)

C
0.5
0
0.5

5

Espectro Rtmico

As formas das 6 PeDF geradas para cada musica, conforme discutido anteriormente, variam
bastante da primeira resolucao (P eDFA5 ) ate a
ultima (P eDFD1 ). Em geral, uma das resolucoes
extremas A5 ou D1 exibem um comportamento
quase periodico. Baseado nesta tendencia opta-

(6)

calcula-se os tempos equivalentes T1  161, 5
bpm e T2  80.8 bpm, respectivamente. O valor
de T2 esta muito proximo do tempo perceptual de
82 bpm do sinal e o de T1 e um multiplo. Caso

176

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014
6

4

10

x 10

x 10

2
8
1.5

4

5

A

SPeDF

5

PeDFA

6

1

2
0.5
0

200

100

0

100

D

200

0

300

Figura 5 PeDF da aproximacao 5 (P eDFA5 ).
mos por realizar uma transformada de Fourier destas P eDF para retirar de seus espectros, aqui denominados de Espectro Rtmico (RS ), os melhores
candidatos a tempo.
Para automatizar a escolha da PeDF menos
ruidosa, ou seja, a com caracterstica mais periodica, utilizamos um descritor classico para sinais
de audio denominado spectral flatness (SF )
(Equacao 7) (Lerch, 2012). Este descritor e uma
medida de quao plano e um espectro de amplitude.

SF 

  exp 

5

0

5

f (Hz)

10

4

8

x 10

PeDFD

6
4
2
0
2
300

200

100

0

D

100

200

300

Figura 7 PeDF do detalhe 1 (P eDFD5 1 )..




(7)

6

x 10

onde os parametros  e  sao dados respectivamente pelas Equacoes 8 e 9


F21
2 X

log(X(k, n))
F

(8)

1

D

2

SPeDF



10

Figura 6 Densidade Espectral de Potencia da
P eDFA5 .

1

2
300

1.5
1
0.5

k0

0


  exp 

2

F

F21

X


X(k, n)

(9)

0

f(Hz)

5

10

E importante ressaltar que, como pode ser observado das Figuras 6 e 8, a faixa de frequencias
de interesse do RS, neste trabalho, compreende
os valores entre 0, 6 Hz (36 bpm) e 4 Hz (240
bpm), faixa rtmica. Esta faixa, portanto, esta
bem aquem da que se costuma trabalhar em processamento de audio (espectro audvel) pois a escala temporal dos fenomenos rtmicos e distinta
da escala temporal das oscilacoes percebidas como
notas musicais.
Dado que nos exemplos aqui expostos o SF
da P eDFD1 foi menor, indicando uma tendencia
menos ruidosa desta funcao, a sua densidade espectral pode ser utilizada para a extracao de candidatos a tempo. O maior pico observado na Figura 8 na faixa rtmica possui um valor de frequencia f  2, 24 Hz que multiplicado por 60 gera
T  134, 4 bpm. O andamento desta musica e
de 66 bpm, ou seja, a componente de frequencia

Tabela 1 Resultados Spectral Flatness
Funcao
P eDFA5
P eDFD1

5

Figura 8 Densidade Espectral de Potencia da
P eDFD1 .

k0

onde F e o comprimento do frame para analise,
que no nosso caso e o proprio comprimento da
P eDF .
E possvel verificar a viabilidade do uso deste
descritor para a selecao de P eDF candidatas observando os exemplos a seguir. Nas Figuras 5 e 7
exibimos as P eDFA5 e P eDFD1 , respectivamente,
de uma musica em nosso banco_de_dados. Nas Figuras 6 e 8 estao descritos os respectivos espectros
de amplitude, SP eDFA5 e SP eDFD1 .
Observe que o espectro da Figura 6 tem uma
tendencia mais plana visualmente, resultado confirmado pelos valores de SF calculados na Tabela
1.

Descritor
SF
SF

10

Resultado
0, 3774
0, 2990

177

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

mais proeminente exibiu aproximadamente o dobro do andamento. Outras informacoes podem ser
retiradas em faixas superiores de frequencia como
a segunda harmonica do andamento encontrado.
Assim, decidimos elaborar um metodo de decisao
heurstico simples que, a partir das raias do espectro rtmico, estime o andamento musical.
6

na literatura (Zapata and Gomes, 2011) pois 66
das cancoes sao brasileiras, musicas com caractersticas intrnsecas de fusao de diversas matrizes
rtmicas, o que torna a tarefa em estudo bastante
complexa. Todos os arquivos deste banco_de_dados
foram importados para o ambiente computacional
a partir de CDs de audio originais e armazenados
em formato wave para garantir a qualidade no que
se refere a resposta_em_frequencia. O downmixing
dos arquivos, ou seja, transformacao de sinais estereo em sinais mono, e realizado gerando um unico
vetor por musica.
Para garantir uma correta determinacao manual dos andamentos de cada peca musical e o
descarte de musicas com flutuacoes de tempo, a
seguinte metodologia foi empregada

Decisao Heurstica

Para a confeccao de uma instancia decisoria a partir das informacoes que podem ser extradas do
RS utilizamos conceitos basicos sobre as estruturas metricas que podem ocorrer em um sinal musical. Por exemplo, e possvel que uma cancao exiba
3 nveis hierarquicos com eventos ocorrendo a 60,
120 e 240 bpm. Isto sugere que a faixa rtmica do
RS pode ser avaliada em mais de uma particao
para a busca de similaridades em nveis hierarquicos distintos. Com isto optamos por avaliar o RS
em duas faixas

 escolha de musicas executadas com bateria
ou instrumentos de percussao reforcando os
beats
 audicao de um trecho de cada peca entre os
instantes de tempo ti  40s e tf  90s determinando o bpm e sua estabilidade dentro
deste trecho

 0, 6  f1  4 Hz (36  T1  240 bpm)
 4 < f2  6 Hz (240 < T1  360 bpm)

 uso de um programa comercial de tempo tapping via teclado do computador para determinacao manual de andamento.

onde f1 e f2 sao os valores em Hertz das frequencias relacionadas aos picos maximos calculados
nas faixas em questao. Uma vez calculadas as
duas frequencias elas sao subdivididas formando
um conjunto de possibilidades metricas

O trecho de audio selecionado a partir dos 40
segundos iniciais garante, geralmente, que a parte
transitoria do arranjo musical tenha sido executada. O programa de tempo tapping foi validado
comparando os resultados determinados a partir
de um metronomo digital. Assim, este conjunto
de andamentos formam o ground truth do nosso
sistema.

 f1  vf1 , (f1 , f1 2, f1 3, f1 4, f1 5, f1 6)
 f2  vf2 , (f2 2, f2 3, f2 4, f2 5, f2 6, f2 8)
Estes valores sao comparados e confronta-se
este resultado com um determinado valor de tolerancia
vf1  vf2   tol

7.2

(10)

Alguns estudos comparativos sobre algoritmos de
extracao de tempo foram realizados pela comunidade MIR e um dos mais recentes (Zapata and
Gomes, 2011) considera 3 metricas para a avaliacao_de_desempenho da extracao de andamento

onde tol e a tolerancia. Para garantir que haja
sempre uma sada do algoritmo, com a maior similaridade possvel entre os valores comparados,
tol e incrementado de 0, 01 Hz (0, 6 bpm), a cada
verificacao, a partir do tol  0. Apesar, da possibilidade de coexistencia de nveis metricos multiplos, as comparacoes de f1 com os submultiplos
de f2 sao prioritariamente checadas no fluxo de
operacoes do algoritmo.
7
7.1

Testes e Analise de Erro

 Metrica 1 Valores detectados que estejam
dentro de janela de precisao de 4 do ground
truth
 Metrica 2 Valores detectados que estejam
dentro de janela de precisao de 4 do ground
truth e seus submultiplos (12 e 13) e multiplos (2 e 3)

Resultados

Banco de Dados

Para avaliar os algoritmos implementados foi necessaria a confeccao de um banco_de_dados que
contivesse 3 atributos principais quantidade,
qualidade e diversidade. Desta forma 507 musicas dos mais diversos generos musicais e andamentos foram selecionadas. Deve-se ressaltar que este
banco de musicas difere bastante dos utilizados

 Metrica 3 Valores detectados que estejam
dentro de janela de precisao de 4 do ground
truth e seus submultiplos (12, 13 e 14) e
multiplos (2, 3, 4 e 6)
As metricas 2 e 3 buscam incluir a deteccao
de tempo que sofra de ambiguidades devido aos

178

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

varios nveis hierarquicos do beat, pois e comum
resultados como tempo dobrado, triplicado e etc.
Tomando estas metricas como baliza, deve-se observar que

os algortmos recentemente avaliados. Considerando a metrica 1 obtivemos 37, 67 de acertos e
para a metrica 2 62, 92. Dado que o nosso banco
de dados possui 66 de musica brasileira com generos musicais como samba, samba de roda, ijexa
e outros, e que a complexidade rtmica e uma caracterstica inerente destes generos, o desempenho
exibido pelo sistema aqui desenvolvido e promissor. Para o prosseguimento da pesquisa, incluiremos a analise das outras resolucoes da P eDF e a
correlacao das resolucoes. Pretende-se, tambem,
o refinamento do tratamento heurstico de decisao
a partir do uso de outras estrategias.

 4@60 bpm  2, 4 bpm
 4@120 bpm  4, 8 bpm
 4@240 bpm  9, 6 bpm
ou seja, o tamanho da janela de precisao varia de
acordo com o valor do ground truth.
Avaliando o desempenho do nosso sistema a
partir dos resultados obtidos para o conjunto de
507 musicas do nosso banco_de_dados, se considerarmos a janela de precisao, houve um ndice de
acerto de 37, 67, considerando a metrica 1. Em
Zapata and Gomes (2011), 23 algoritmos sao avaliados e o pior e o melhor desempenho, avaliando
somente a metrica 1, foi de 5, 15 e 60, 43, respectivamente. Neste confronto e importante ressaltar um aspecto. A base de dados usada em Zapata and Gomes (2011) e muito diferente da nossa
base. So para citar uma diferenca fundamental,
das 465 musicas do trabalho de Zapata and Gomes (2011) 59 sao do genero eletronico e 144 musicas classificadas como grega e balca, enquanto no
nosso banco de musicas nao ha musica eletronica
e mais de 66 e de musica brasileira. O genero
de musica eletronica torna a tarefa em questao,
extracao de tempo, muito mais simplificada, pois
a presenca marcante do beat neste tipo de musica e ponto fulcral. Para alem disto, como citado
anteriormente, a musica brasileira possui um corpus extremamente variado e complexo do ponto
de vista rtmico devido a fusao de elementos do
samba, africanos, indgenas, ocidentais e outros,
estando estes elementos marcadamente presentes
em nosso banco_de_dados. Se utilizarmos a metrica 2 o desempenho de nosso sistema sobe para
62, 92 enquanto o pior e o melhor em Zapata
and Gomes (2011) sao 32, 26 e 91, 18, respectivamente.
8

Referencias
Alonso, M., David, B. and Richard, G. (2004). A
hybrid approach to musical note onset detection, Proc. 5th Int. Symp. Music Inf. Retrieval (ISMIR-2004).
Bello, J. P., Daudet, L. and Abdallah, S. (2005).
A tutorial on onset detection in music signals, IEEE Transactions on Audio, Speech,
and Language Processing pp. 113.
Bello, J. P., Duxbury, C., Davies, M. and Sandler, M. (2004). On the Use of Phase and
Energy for Musical Onset Detection in the
Complex Domain, IEEE Signal Processing
Letters 11(6) 553556.
Davies, M. E. P. and Plumbley, M. D. (2007).
Context-Dependent Beat Tracking of Musical
Audio, IEEE Transactions on Audio, Speech
and Language Processing 15(3) 10091020.
Dixon, S. (2006). Onset detection revisited, Proc.
Digital Audio Effects (DAFx-06), Montreal,
Canada.
Duxbury, C., Bello, J. P., Davies, M. and Sandler,
M. (2003). Complex domain onset detection
for musical signals, Proc. Digital Audio Effects (DAFx-03), London, UK.

Conclusoes

Fernandes Jr, A. C. L. and Damiani, F. (2013).
Tempo extraction in musical signals using
complex domain and wavelet transforms,
Proceedings of the SPS 2013, Campinas, Brazil.

Neste artigo apresentamos uma nova abordagem
para a extracao automatica de tempo musical avaliando as transformadas de Fourier de funcoes de
deteccao de periodicidade (P eDF ) multirresolucionais, denominadas por nos de Espectro Rtmico.
Para a construcao das P eDF utilizamos a Transformada Wavelet para a analise multirresolucao e
o metodo do Domnio Complexo para o calculo de
funcoes de deteccao de onsets em cada resolucao.
A analise a partir do RS foi feita utilizando-se um
tratamento heurstico baseado em possibilidades
metricas existentes no ritmo. O resultado de nosso
sistema para um banco_de_dados com 507 musicas,
construdo por nos, mostrou ser competitivo com

Gainza, M. and Coyle, E. (2011). Tempo Detection Using a Hybrid Multiband Approach,
IEEE Transactions on Audio, Speech, and
Language Processing 19(1) 5768.
Klapuri, A., Eronen, A. and Astola, J. (2006).
Analysis of the meter of acoustic musical signals, IEEE Transactions on Audio, Speech
and Language Processing 14(1) 342355.

179

Anais do XX Congresso Brasileiro de Automática
Belo Horizonte, MG, 20 a 24 de Setembro de 2014

Laroche, J. (2001). Estimating Tempo, Swing,
and Beat Locations in Audio Recordings ,
IEEE Workshop on Applications of Signal
Processing to Audio and Acoustics pp. 135
138.
Lerch, A. (2012). An Introduction to Audio Content Analysis, first edn, John Wiley and Sons,
New Jersey, USA.
Peeters, G. (2011). Spectral and Temporal Periodicity Representations of Rhythm for the
Automatic Classification of Music Audio Signal, IEEE Transactions on Audio, Speech,
and Language Processing 19(5) 12421252.
Scheirer, E. (1998). Tempo and beat analysis of
acoustic musical signals, The Journal of the
Acoustical Society of America 103 588601.
Strang, G. and Nguyen, T. (1997). Wavelet
and Filter Banks, second edn, WellesleyCambridge Press, Wellesley MA, USA.
Zapata, J. R. and Gomes, E. (2011). Comparative
evaluation and combination of audio tempo
estimation approaches, AES 42nd International Conference, Ilmenau, Germany, pp. 1
10.

180